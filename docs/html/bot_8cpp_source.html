<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Daredevil - Emergency Rescue Robot: bot.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logoImage.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Daredevil - Emergency Rescue Robot
   &#160;<span id="projectnumber">0.2</span>
   </div>
   <div id="projectbrief">This project implements the frontier exploration task where the robot has to react in an emergency situation and lead the person to the exit of the building. The project is just a simulation of the robot in Gazebo which will show the autonomous exploration of the unknown environment and finding the exit of the building by following the exit signs.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('bot_8cpp_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">bot.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="bot_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;../include/bot.h&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &lt;math.h&gt;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;../include/sensor.h&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;../include/camera.h&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;ros/ros.h&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;geometry_msgs/Twist.h&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">// Implementation of default Bot constructor</span></div><div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="class_bot.html#a14b4bfcbda8c051d8447e73073567b50">   42</a></span>&#160;<a class="code" href="class_bot.html#a14b4bfcbda8c051d8447e73073567b50">Bot::Bot</a>(<a class="code" href="class_sensor.html">Sensor</a>* iSensor, <a class="code" href="class_camera.html">Camera</a>* iCamera)</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    : sensor(iSensor),</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;      camera(iCamera),</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;      nextTurnRight(false),</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;      nextTurnLeft(false),</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;      maxSpeed(0.5),</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;      turnAngle(1.57),</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;      searchAngle(1.2) {</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="comment">// Publisher to publish messages on /navi topic</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  pubVel = nh.advertise &lt; geometry_msgs::Twist</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;      &gt; (<span class="stringliteral">&quot;/cmd_vel_mux/input/navi&quot;</span>, 1000);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  ROS_INFO(<span class="stringliteral">&quot;Default ROBOT Created!&quot;</span>);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <a class="code" href="class_bot.html#aeae87db5fd2d6a130587f665e39a6557">resetBot</a>();</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;}</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">// Destructor that resets the velocity of the bot</span></div><div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="class_bot.html#a4163b0f6c91f94cbeb3145eeda8cd361">   57</a></span>&#160;<a class="code" href="class_bot.html#a4163b0f6c91f94cbeb3145eeda8cd361">Bot::~Bot</a>() {</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <a class="code" href="class_bot.html#aeae87db5fd2d6a130587f665e39a6557">resetBot</a>();</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;}</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">// Start the bot with obstacle avoidance functionality</span></div><div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="class_bot.html#a5c1f98ef7f22894832865c5987d184c3">   61</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_bot.html#a5c1f98ef7f22894832865c5987d184c3">Bot::startMotion</a>() {</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  ros::Rate loop_rate(5);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="keywordflow">while</span> (ros::ok()) {</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">// Get values from the sensor</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    ROS_INFO(<span class="stringliteral">&quot;Right: %f, left: %f, forward: %f, nowturn: %d&quot;</span>,</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;             sensor-&gt;<a class="code" href="class_sensor.html#a784ee9b741908df505a51d0807dbbe9b">getRightReading</a>(), sensor-&gt;<a class="code" href="class_sensor.html#a68826b1eb0dcda3a0508f213a42db25b">getLeftReading</a>(),</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;             sensor-&gt;<a class="code" href="class_sensor.html#a0cb8d226a7df00fa404c100f959868e6">getForwardReading</a>(), camera-&gt;<a class="code" href="class_camera.html#a6b27e3016f42ac8af96601426e009c1b">getNowTurn</a>());</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordflow">if</span> (sensor-&gt;<a class="code" href="class_sensor.html#af590a94a155718952a71ee842a0db661">getObstacleDetected</a>()) {</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      ROS_INFO(<span class="stringliteral">&quot;Wall Detected&quot;</span>);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;      msg.linear.x = 0.0;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      pubVel.publish(msg);</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;      <span class="comment">// Adjust itself to be perpendicular to the wall</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      <span class="keywordflow">if</span> (!isnanf(sensor-&gt;<a class="code" href="class_sensor.html#a784ee9b741908df505a51d0807dbbe9b">getRightReading</a>())</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;          &amp;&amp; !isnanf(sensor-&gt;<a class="code" href="class_sensor.html#a68826b1eb0dcda3a0508f213a42db25b">getLeftReading</a>()) &amp;&amp; sensor-&gt;<a class="code" href="class_sensor.html#a784ee9b741908df505a51d0807dbbe9b">getRightReading</a>() &lt; 3</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;          &amp;&amp; sensor-&gt;<a class="code" href="class_sensor.html#a68826b1eb0dcda3a0508f213a42db25b">getLeftReading</a>() &lt; 3</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;          &amp;&amp; fabs(sensor-&gt;<a class="code" href="class_sensor.html#a784ee9b741908df505a51d0807dbbe9b">getRightReading</a>() - sensor-&gt;<a class="code" href="class_sensor.html#a68826b1eb0dcda3a0508f213a42db25b">getLeftReading</a>()) &lt; 1) {</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <span class="keyword">auto</span> error = fabs(</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;            fabs(sensor-&gt;<a class="code" href="class_sensor.html#a784ee9b741908df505a51d0807dbbe9b">getRightReading</a>()) - fabs(sensor-&gt;<a class="code" href="class_sensor.html#a68826b1eb0dcda3a0508f213a42db25b">getLeftReading</a>()))</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;            * 1.0;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        ROS_INFO(<span class="stringliteral">&quot;Adjusting&quot;</span>);</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="keywordflow">if</span> (sensor-&gt;<a class="code" href="class_sensor.html#a784ee9b741908df505a51d0807dbbe9b">getRightReading</a>() &gt; sensor-&gt;<a class="code" href="class_sensor.html#a68826b1eb0dcda3a0508f213a42db25b">getLeftReading</a>() &amp;&amp; error &gt; 0.05</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            &amp;&amp; error &lt; 1) {</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;          <a class="code" href="class_bot.html#a6f9bf5628c1faedb8da493b381ba95ac">turnLeft</a>(error);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;          ROS_INFO(<span class="stringliteral">&quot;Adjusting left&quot;</span>);</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sensor-&gt;<a class="code" href="class_sensor.html#a784ee9b741908df505a51d0807dbbe9b">getRightReading</a>() &lt; sensor-&gt;<a class="code" href="class_sensor.html#a68826b1eb0dcda3a0508f213a42db25b">getLeftReading</a>()</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            &amp;&amp; error &gt; 0.05 &amp;&amp; error &lt; 1) {</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;          <a class="code" href="class_bot.html#a07fd8d141a617b711eee7ab3c9e99171">turnRight</a>(error);</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;          ROS_INFO(<span class="stringliteral">&quot;Adjusting right&quot;</span>);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;          msg.angular.z = 0.0;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;          ROS_INFO(<span class="stringliteral">&quot;Adjustment zero&quot;</span>);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        }</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      }</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      pubVel.publish(msg);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      ROS_INFO(<span class="stringliteral">&quot;No Adjustment&quot;</span>);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <a class="code" href="class_bot.html#a057a268f423e1d8aa71f01ff4bf23149">checkFreeDirection</a>(searchAngle, turnAngle);</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      ROS_INFO(<span class="stringliteral">&quot;Path is clear!&quot;</span>);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      <span class="keyword">auto</span> error = fabs(</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;          fabs(sensor-&gt;<a class="code" href="class_sensor.html#a784ee9b741908df505a51d0807dbbe9b">getRightReading</a>()) - fabs(sensor-&gt;<a class="code" href="class_sensor.html#a68826b1eb0dcda3a0508f213a42db25b">getLeftReading</a>()))</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;          * 1.0;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      <span class="keywordflow">if</span> (!isnanf(sensor-&gt;<a class="code" href="class_sensor.html#a784ee9b741908df505a51d0807dbbe9b">getRightReading</a>())</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;          &amp;&amp; !isnanf(sensor-&gt;<a class="code" href="class_sensor.html#a68826b1eb0dcda3a0508f213a42db25b">getLeftReading</a>())) {</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="keyword">auto</span> gain = 0.0;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <span class="keywordflow">if</span> (error &gt; 0.5)</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;          gain = 0.05;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;          gain = 0.2;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        ROS_INFO(<span class="stringliteral">&quot;Error: %f, gain: %f&quot;</span>, error, gain);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="keywordflow">if</span> (sensor-&gt;<a class="code" href="class_sensor.html#a784ee9b741908df505a51d0807dbbe9b">getRightReading</a>() &gt; sensor-&gt;<a class="code" href="class_sensor.html#a68826b1eb0dcda3a0508f213a42db25b">getLeftReading</a>()) {</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;          msg.angular.z = -gain * error;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;          msg.angular.z = gain * error;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        }</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      }</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      <span class="keywordflow">if</span> (camera-&gt;<a class="code" href="class_camera.html#a6b27e3016f42ac8af96601426e009c1b">getNowTurn</a>() == 10 &amp;&amp; sensor-&gt;<a class="code" href="class_sensor.html#a784ee9b741908df505a51d0807dbbe9b">getRightReading</a>() &gt; 3</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;          &amp;&amp; !nextTurnRight) {</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        nextTurnRight = <span class="keyword">true</span>;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        nextTurnLeft = <span class="keyword">false</span>;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        camera-&gt;<a class="code" href="class_camera.html#a77cd72118fd9d03e04beaf60f7345138">setNowTurn</a>(0);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        camera-&gt;<a class="code" href="class_camera.html#a66d6f05a42feb58468bc4039b07b1b23">setCountB</a>(0);</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        camera-&gt;<a class="code" href="class_camera.html#ab51102514272832890346b414759e716">setSignDetected</a>(<span class="keyword">false</span>);</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (camera-&gt;<a class="code" href="class_camera.html#a6b27e3016f42ac8af96601426e009c1b">getNowTurn</a>() == 5 &amp;&amp; sensor-&gt;<a class="code" href="class_sensor.html#a68826b1eb0dcda3a0508f213a42db25b">getLeftReading</a>() &gt; 3</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;          &amp;&amp; !nextTurnLeft) {</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        nextTurnLeft = <span class="keyword">true</span>;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        nextTurnRight = <span class="keyword">false</span>;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        camera-&gt;<a class="code" href="class_camera.html#a77cd72118fd9d03e04beaf60f7345138">setNowTurn</a>(0);</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        camera-&gt;<a class="code" href="class_camera.html#a3186b8e7cf648308237a2ba440379e34">setCount</a>(0);</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        camera-&gt;<a class="code" href="class_camera.html#ab51102514272832890346b414759e716">setSignDetected</a>(<span class="keyword">false</span>);</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (camera-&gt;<a class="code" href="class_camera.html#a6b27e3016f42ac8af96601426e009c1b">getNowTurn</a>() == 15) {</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;          msg.angular.z = 0.0;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <a class="code" href="class_bot.html#a308e7e40f00a853d1397cfafcb7d2cd5">doorDetection</a>();</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        }</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="keywordflow">if</span> (nextTurnRight) {</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        msg.angular.z = -0.48;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        ROS_INFO_STREAM(<span class="stringliteral">&quot;Right Turn Initiate&quot;</span>);</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;          camera-&gt;<a class="code" href="class_camera.html#a77cd72118fd9d03e04beaf60f7345138">setNowTurn</a>(0);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="keywordflow">if</span> (isnanf(sensor-&gt;<a class="code" href="class_sensor.html#a0cb8d226a7df00fa404c100f959868e6">getForwardReading</a>())</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            || sensor-&gt;<a class="code" href="class_sensor.html#a0cb8d226a7df00fa404c100f959868e6">getForwardReading</a>() &gt; 5) {</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;          nextTurnRight = <span class="keyword">false</span>;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;          msg.angular.z = 0;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;          camera-&gt;<a class="code" href="class_camera.html#a66d6f05a42feb58468bc4039b07b1b23">setCountB</a>(0);</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;          camera-&gt;<a class="code" href="class_camera.html#a77cd72118fd9d03e04beaf60f7345138">setNowTurn</a>(0);</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        }</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        }</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      <span class="keywordflow">if</span> (nextTurnLeft) {</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        msg.angular.z = 0.48;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        ROS_INFO_STREAM(<span class="stringliteral">&quot;Left Turn Initiate&quot;</span>);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;          camera-&gt;<a class="code" href="class_camera.html#a77cd72118fd9d03e04beaf60f7345138">setNowTurn</a>(0);</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keywordflow">if</span> (isnanf(sensor-&gt;<a class="code" href="class_sensor.html#a0cb8d226a7df00fa404c100f959868e6">getForwardReading</a>())</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            || sensor-&gt;<a class="code" href="class_sensor.html#a0cb8d226a7df00fa404c100f959868e6">getForwardReading</a>() &gt; 5) {</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;          nextTurnLeft = <span class="keyword">false</span>;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;          msg.angular.z = 0;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;          camera-&gt;<a class="code" href="class_camera.html#a3186b8e7cf648308237a2ba440379e34">setCount</a>(0);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;          camera-&gt;<a class="code" href="class_camera.html#a77cd72118fd9d03e04beaf60f7345138">setNowTurn</a>(0);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        }</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        }</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      msg.linear.x = maxSpeed;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="comment">// Publish the velocity information</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    pubVel.publish(msg);</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    ros::spinOnce();</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    loop_rate.sleep();</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  }</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;}</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">// Set translational and rotational properties to zero</span></div><div class="line"><a name="l00168"></a><span class="lineno"><a class="line" href="class_bot.html#aeae87db5fd2d6a130587f665e39a6557">  168</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_bot.html#aeae87db5fd2d6a130587f665e39a6557">Bot::resetBot</a>() {</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  msg.linear.x = 0.0;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  msg.linear.y = 0.0;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  msg.linear.z = 0.0;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  msg.angular.x = 0.0;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  msg.angular.y = 0.0;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  msg.angular.z = 0.0;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  pubVel.publish(msg);</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;}</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">// get maximum linear speed by the bot</span></div><div class="line"><a name="l00178"></a><span class="lineno"><a class="line" href="class_bot.html#a4a3b192232d8b938f11c1d253795c222">  178</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="class_bot.html#a4a3b192232d8b938f11c1d253795c222">Bot::getMaxSpeed</a>() {</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="keywordflow">return</span> maxSpeed;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;}</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">// turn the robot in right direction</span></div><div class="line"><a name="l00182"></a><span class="lineno"><a class="line" href="class_bot.html#a07fd8d141a617b711eee7ab3c9e99171">  182</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_bot.html#a07fd8d141a617b711eee7ab3c9e99171">Bot::turnRight</a>(<span class="keywordtype">double</span> desiredAngle) {</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  ROS_INFO(<span class="stringliteral">&quot;Turning in right direction&quot;</span>);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  ros::Rate loop_rate(10);</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  desiredAngle = desiredAngle - sensor-&gt;<a class="code" href="class_sensor.html#a1984ff9826d1c92d7e91add776a4107b">getCurrentYaw</a>();</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="keywordflow">while</span> (ros::ok()) {</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keyword">auto</span> error = fabs(fabs(sensor-&gt;<a class="code" href="class_sensor.html#a1984ff9826d1c92d7e91add776a4107b">getCurrentYaw</a>()) - fabs(desiredAngle)) * 1.0;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    msg.angular.z = -1.5 * error;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    pubVel.publish(msg);</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    ros::spinOnce();</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    loop_rate.sleep();</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordflow">if</span> (error &lt;= 0.01 &amp;&amp; error &gt;= -0.99) {</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      ROS_INFO_STREAM(<span class="stringliteral">&quot;break&quot;</span>);</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    }</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  }</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;}</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">// turn the robot in left direction</span></div><div class="line"><a name="l00199"></a><span class="lineno"><a class="line" href="class_bot.html#a6f9bf5628c1faedb8da493b381ba95ac">  199</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_bot.html#a6f9bf5628c1faedb8da493b381ba95ac">Bot::turnLeft</a>(<span class="keywordtype">double</span> desiredAngle) {</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  ROS_INFO(<span class="stringliteral">&quot;Turning in left direction&quot;</span>);</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  ros::Rate loop_rate(10);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  desiredAngle = sensor-&gt;<a class="code" href="class_sensor.html#a1984ff9826d1c92d7e91add776a4107b">getCurrentYaw</a>() + desiredAngle;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="keywordflow">while</span> (ros::ok()) {</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keyword">auto</span> error = fabs(fabs(desiredAngle) - fabs(sensor-&gt;<a class="code" href="class_sensor.html#a1984ff9826d1c92d7e91add776a4107b">getCurrentYaw</a>())) * 1.0;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    msg.angular.z = 1.5 * error;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    pubVel.publish(msg);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    ros::spinOnce();</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    loop_rate.sleep();</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">if</span> (error &lt;= 0.01 &amp;&amp; error &gt;= -0.99) {</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      ROS_INFO_STREAM(<span class="stringliteral">&quot;break&quot;</span>);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    }</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  }</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;}</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">// move forward by certain distance</span></div><div class="line"><a name="l00216"></a><span class="lineno"><a class="line" href="class_bot.html#abc25556b72a44e45056d161eaa48e1c6">  216</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_bot.html#abc25556b72a44e45056d161eaa48e1c6">Bot::moveForward</a>(<span class="keywordtype">double</span> desiredPos) {</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  ros::Time start = ros::Time::now();</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  ros::Duration duration(2, 0);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  ros::Rate loop_rate(10);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="comment">// velocity = distance / time</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  maxSpeed = desiredPos / 2;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="keywordflow">while</span> ((ros::Time::now() - start) &lt; duration) {</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    msg.linear.x = maxSpeed;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    msg.angular.z = 0.0;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    pubVel.publish(msg);</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    ros::spinOnce();</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    loop_rate.sleep();</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  }</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;}</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">// Search for the free path</span></div><div class="line"><a name="l00231"></a><span class="lineno"><a class="line" href="class_bot.html#a057a268f423e1d8aa71f01ff4bf23149">  231</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_bot.html#a057a268f423e1d8aa71f01ff4bf23149">Bot::checkFreeDirection</a>(<span class="keywordtype">double</span> searchAngle, <span class="keywordtype">double</span> turnAngle) {</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  ROS_INFO(<span class="stringliteral">&quot;Checking free direction&quot;</span>);</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="comment">// door reached</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="keywordflow">if</span> (sensor-&gt;<a class="code" href="class_sensor.html#a0cb8d226a7df00fa404c100f959868e6">getForwardReading</a>() &gt; 10 &amp;&amp; searchAngle == 0.0</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      &amp;&amp; turnAngle == 0.0) {</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    sensor-&gt;<a class="code" href="class_sensor.html#ae3914c5ebf7891ec734c4d17e7c4cd3d">setObstacleDetected</a>(<span class="keyword">false</span>);</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  }</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="comment">// Get values from the sensor</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="keyword">auto</span> safeDistance = sensor-&gt;<a class="code" href="class_sensor.html#a1b7aad1c82fa6df205b166b311f45447">getSafeDistance</a>();</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <a class="code" href="class_bot.html#a07fd8d141a617b711eee7ab3c9e99171">turnRight</a>(searchAngle);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="comment">// turn 60 and get right value which will be 180deg</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="comment">// value for original configuration</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  ROS_INFO(<span class="stringliteral">&quot;Right reading: %f&quot;</span>, sensor-&gt;<a class="code" href="class_sensor.html#a784ee9b741908df505a51d0807dbbe9b">getRightReading</a>());</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keyword">auto</span> extremeRightVal = sensor-&gt;<a class="code" href="class_sensor.html#a784ee9b741908df505a51d0807dbbe9b">getRightReading</a>();</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <a class="code" href="class_bot.html#a6f9bf5628c1faedb8da493b381ba95ac">turnLeft</a>(searchAngle);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <a class="code" href="class_bot.html#a6f9bf5628c1faedb8da493b381ba95ac">turnLeft</a>(searchAngle);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <span class="comment">// turn 60 and get left value which will be 180deg</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="comment">// value for original configuration</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  ROS_INFO(<span class="stringliteral">&quot;Left reading: %f&quot;</span>, sensor-&gt;<a class="code" href="class_sensor.html#a68826b1eb0dcda3a0508f213a42db25b">getLeftReading</a>());</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <span class="keyword">auto</span> extremeLeftVal = sensor-&gt;<a class="code" href="class_sensor.html#a68826b1eb0dcda3a0508f213a42db25b">getLeftReading</a>();</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <a class="code" href="class_bot.html#a07fd8d141a617b711eee7ab3c9e99171">turnRight</a>(searchAngle);</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  ROS_INFO(<span class="stringliteral">&quot;Straight: %f, Right: %f, Left: %f&quot;</span>, sensor-&gt;<a class="code" href="class_sensor.html#a0cb8d226a7df00fa404c100f959868e6">getForwardReading</a>(),</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;           sensor-&gt;<a class="code" href="class_sensor.html#a784ee9b741908df505a51d0807dbbe9b">getRightReading</a>(),</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;           sensor-&gt;<a class="code" href="class_sensor.html#a68826b1eb0dcda3a0508f213a42db25b">getLeftReading</a>());</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="keywordflow">if</span> (isnanf(sensor-&gt;<a class="code" href="class_sensor.html#a0cb8d226a7df00fa404c100f959868e6">getForwardReading</a>()) || sensor-&gt;<a class="code" href="class_sensor.html#a0cb8d226a7df00fa404c100f959868e6">getForwardReading</a>() &gt; 4) {</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    ROS_INFO(<span class="stringliteral">&quot;Forward Path is longer&quot;</span>);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <a class="code" href="class_bot.html#abc25556b72a44e45056d161eaa48e1c6">moveForward</a>(1);</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    maxSpeed = 0.5;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  }</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keywordflow">if</span> (isnanf(extremeRightVal) || sensor-&gt;<a class="code" href="class_sensor.html#a784ee9b741908df505a51d0807dbbe9b">getRightReading</a>() &gt; 5) {</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    ROS_INFO(<span class="stringliteral">&quot;Right Path is longer&quot;</span>);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <a class="code" href="class_bot.html#a07fd8d141a617b711eee7ab3c9e99171">turnRight</a>(turnAngle);</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  }</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="keywordflow">if</span> (isnanf(extremeLeftVal) || sensor-&gt;<a class="code" href="class_sensor.html#a68826b1eb0dcda3a0508f213a42db25b">getLeftReading</a>() &gt; 5) {</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    ROS_INFO(<span class="stringliteral">&quot;Left Path is longer&quot;</span>);</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <a class="code" href="class_bot.html#a6f9bf5628c1faedb8da493b381ba95ac">turnLeft</a>(turnAngle);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  }</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keywordflow">if</span> (sensor-&gt;<a class="code" href="class_sensor.html#a0cb8d226a7df00fa404c100f959868e6">getForwardReading</a>() &lt; safeDistance</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      &amp;&amp; extremeRightVal &gt; extremeLeftVal</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      &amp;&amp; extremeRightVal &gt; 3) {</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    ROS_INFO(<span class="stringliteral">&quot;Right Path is longer&quot;</span>);</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <a class="code" href="class_bot.html#a07fd8d141a617b711eee7ab3c9e99171">turnRight</a>(turnAngle);</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  }</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordflow">if</span> (sensor-&gt;<a class="code" href="class_sensor.html#a0cb8d226a7df00fa404c100f959868e6">getForwardReading</a>() &lt; safeDistance</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      &amp;&amp; extremeRightVal &lt; extremeLeftVal</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      &amp;&amp; extremeLeftVal &gt; 3) {</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    ROS_INFO(<span class="stringliteral">&quot;Left Path is longer&quot;</span>);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <a class="code" href="class_bot.html#a6f9bf5628c1faedb8da493b381ba95ac">turnLeft</a>(turnAngle);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    ROS_INFO(<span class="stringliteral">&quot;Turn Around&quot;</span>);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <a class="code" href="class_bot.html#a6f9bf5628c1faedb8da493b381ba95ac">turnLeft</a>(turnAngle);</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <a class="code" href="class_bot.html#a6f9bf5628c1faedb8da493b381ba95ac">turnLeft</a>(turnAngle);</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  }</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;}</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">// Pass through the door without colliding</span></div><div class="line"><a name="l00293"></a><span class="lineno"><a class="line" href="class_bot.html#a308e7e40f00a853d1397cfafcb7d2cd5">  293</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_bot.html#a308e7e40f00a853d1397cfafcb7d2cd5">Bot::doorDetection</a>() {</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  ros::Time start = ros::Time::now();</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  ros::Duration duration(12, 0);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  ros::Rate loop_rate(10);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="keywordflow">while</span> ((ros::Time::now() - start) &lt; duration) {</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keyword">auto</span> rightDist = sensor-&gt;<a class="code" href="class_sensor.html#a784ee9b741908df505a51d0807dbbe9b">getRightReading</a>();</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keyword">auto</span> leftDist = sensor-&gt;<a class="code" href="class_sensor.html#a68826b1eb0dcda3a0508f213a42db25b">getLeftReading</a>();</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keyword">auto</span> forwardDist = sensor-&gt;<a class="code" href="class_sensor.html#a0cb8d226a7df00fa404c100f959868e6">getForwardReading</a>();</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    ROS_INFO(<span class="stringliteral">&quot;Door detection&quot;</span>);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    ROS_INFO(<span class="stringliteral">&quot;Left: %f, Forward: %f, Right: %f&quot;</span>, leftDist, rightDist,</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;             forwardDist);</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keywordflow">if</span> (isnanf(sensor-&gt;<a class="code" href="class_sensor.html#a0cb8d226a7df00fa404c100f959868e6">getForwardReading</a>()))</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      forwardDist = 5;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keywordflow">if</span> (isnanf(sensor-&gt;<a class="code" href="class_sensor.html#a784ee9b741908df505a51d0807dbbe9b">getRightReading</a>()))</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      rightDist = 5;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordflow">if</span> (isnanf(sensor-&gt;<a class="code" href="class_sensor.html#a68826b1eb0dcda3a0508f213a42db25b">getLeftReading</a>()))</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      leftDist = 5;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    msg.linear.x = 0.3;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keyword">auto</span> error = fabs(fabs(rightDist) - fabs(leftDist)) * 1.0;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keyword">auto</span> gain = 0.2;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    ROS_INFO(<span class="stringliteral">&quot;Error: %f, gain: %f&quot;</span>, error, gain);</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keywordflow">if</span> (rightDist &gt; leftDist) {</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      msg.angular.z = -gain * error;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      msg.angular.z = gain * error;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    }</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    pubVel.publish(msg);</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    ros::spinOnce();</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    loop_rate.sleep();</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  }</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;}</div><div class="line"><a name="l00324"></a><span class="lineno"><a class="line" href="class_bot.html#ab2b0ed8f324e0ed8777b0ed82bd5a718">  324</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_bot.html#ab2b0ed8f324e0ed8777b0ed82bd5a718">Bot::setSearchAngle</a>(<span class="keywordtype">double</span> search) {</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  searchAngle = search;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;}</div><div class="line"><a name="l00327"></a><span class="lineno"><a class="line" href="class_bot.html#a1df4f3955f1e3dfae7aba746c852945c">  327</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="class_bot.html#a1df4f3955f1e3dfae7aba746c852945c">Bot::setTurnAngle</a>(<span class="keywordtype">double</span> turn) {</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  turnAngle = turn;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;}</div><div class="ttc" id="class_sensor_html"><div class="ttname"><a href="class_sensor.html">Sensor</a></div><div class="ttdef"><b>Definition:</b> <a href="sensor_8h_source.html#l00041">sensor.h:41</a></div></div>
<div class="ttc" id="class_bot_html_a6f9bf5628c1faedb8da493b381ba95ac"><div class="ttname"><a href="class_bot.html#a6f9bf5628c1faedb8da493b381ba95ac">Bot::turnLeft</a></div><div class="ttdeci">void turnLeft(double desiredAngle)</div><div class="ttdoc">turn robot in left direction</div><div class="ttdef"><b>Definition:</b> <a href="bot_8cpp_source.html#l00199">bot.cpp:199</a></div></div>
<div class="ttc" id="class_bot_html_a4a3b192232d8b938f11c1d253795c222"><div class="ttname"><a href="class_bot.html#a4a3b192232d8b938f11c1d253795c222">Bot::getMaxSpeed</a></div><div class="ttdeci">float getMaxSpeed()</div><div class="ttdoc">get maximum speed of robot</div><div class="ttdef"><b>Definition:</b> <a href="bot_8cpp_source.html#l00178">bot.cpp:178</a></div></div>
<div class="ttc" id="class_bot_html_a14b4bfcbda8c051d8447e73073567b50"><div class="ttname"><a href="class_bot.html#a14b4bfcbda8c051d8447e73073567b50">Bot::Bot</a></div><div class="ttdeci">Bot(Sensor *iSensor, Camera *iCamera)</div><div class="ttdoc">Bot class constructor.</div><div class="ttdef"><b>Definition:</b> <a href="bot_8cpp_source.html#l00042">bot.cpp:42</a></div></div>
<div class="ttc" id="class_camera_html_a6b27e3016f42ac8af96601426e009c1b"><div class="ttname"><a href="class_camera.html#a6b27e3016f42ac8af96601426e009c1b">Camera::getNowTurn</a></div><div class="ttdeci">int getNowTurn()</div><div class="ttdoc">Get status for making turning decision.</div><div class="ttdef"><b>Definition:</b> <a href="camera_8cpp_source.html#l00134">camera.cpp:134</a></div></div>
<div class="ttc" id="class_camera_html_a3186b8e7cf648308237a2ba440379e34"><div class="ttname"><a href="class_camera.html#a3186b8e7cf648308237a2ba440379e34">Camera::setCount</a></div><div class="ttdeci">void setCount(int c)</div><div class="ttdoc">Set value of the counter which determines the time after which the robot has to take turn after detec...</div><div class="ttdef"><b>Definition:</b> <a href="camera_8cpp_source.html#l00149">camera.cpp:149</a></div></div>
<div class="ttc" id="class_bot_html_a1df4f3955f1e3dfae7aba746c852945c"><div class="ttname"><a href="class_bot.html#a1df4f3955f1e3dfae7aba746c852945c">Bot::setTurnAngle</a></div><div class="ttdeci">void setTurnAngle(double turn)</div><div class="ttdoc">set turn angle of the robot</div><div class="ttdef"><b>Definition:</b> <a href="bot_8cpp_source.html#l00327">bot.cpp:327</a></div></div>
<div class="ttc" id="class_camera_html"><div class="ttname"><a href="class_camera.html">Camera</a></div><div class="ttdef"><b>Definition:</b> <a href="camera_8h_source.html#l00044">camera.h:44</a></div></div>
<div class="ttc" id="class_bot_html_a057a268f423e1d8aa71f01ff4bf23149"><div class="ttname"><a href="class_bot.html#a057a268f423e1d8aa71f01ff4bf23149">Bot::checkFreeDirection</a></div><div class="ttdeci">void checkFreeDirection(double searchAngle, double turnAngle)</div><div class="ttdoc">if sign is not present make decisions based on sensor reading to turn left or right</div><div class="ttdef"><b>Definition:</b> <a href="bot_8cpp_source.html#l00231">bot.cpp:231</a></div></div>
<div class="ttc" id="class_bot_html_a308e7e40f00a853d1397cfafcb7d2cd5"><div class="ttname"><a href="class_bot.html#a308e7e40f00a853d1397cfafcb7d2cd5">Bot::doorDetection</a></div><div class="ttdeci">void doorDetection()</div><div class="ttdoc">if door is detected, move through the door</div><div class="ttdef"><b>Definition:</b> <a href="bot_8cpp_source.html#l00293">bot.cpp:293</a></div></div>
<div class="ttc" id="class_bot_html_ab2b0ed8f324e0ed8777b0ed82bd5a718"><div class="ttname"><a href="class_bot.html#ab2b0ed8f324e0ed8777b0ed82bd5a718">Bot::setSearchAngle</a></div><div class="ttdeci">void setSearchAngle(double search)</div><div class="ttdoc">set search angle of the robot</div><div class="ttdef"><b>Definition:</b> <a href="bot_8cpp_source.html#l00324">bot.cpp:324</a></div></div>
<div class="ttc" id="class_bot_html_a4163b0f6c91f94cbeb3145eeda8cd361"><div class="ttname"><a href="class_bot.html#a4163b0f6c91f94cbeb3145eeda8cd361">Bot::~Bot</a></div><div class="ttdeci">~Bot()</div><div class="ttdoc">Default destructor.</div><div class="ttdef"><b>Definition:</b> <a href="bot_8cpp_source.html#l00057">bot.cpp:57</a></div></div>
<div class="ttc" id="class_camera_html_ab51102514272832890346b414759e716"><div class="ttname"><a href="class_camera.html#ab51102514272832890346b414759e716">Camera::setSignDetected</a></div><div class="ttdeci">void setSignDetected(bool sD)</div><div class="ttdoc">Set the flag when sign is detected.</div><div class="ttdef"><b>Definition:</b> <a href="camera_8cpp_source.html#l00155">camera.cpp:155</a></div></div>
<div class="ttc" id="class_sensor_html_a0cb8d226a7df00fa404c100f959868e6"><div class="ttname"><a href="class_sensor.html#a0cb8d226a7df00fa404c100f959868e6">Sensor::getForwardReading</a></div><div class="ttdeci">float getForwardReading()</div><div class="ttdoc">Get sensor reading at 0deg.</div><div class="ttdef"><b>Definition:</b> <a href="sensor_8cpp_source.html#l00083">sensor.cpp:83</a></div></div>
<div class="ttc" id="class_sensor_html_a784ee9b741908df505a51d0807dbbe9b"><div class="ttname"><a href="class_sensor.html#a784ee9b741908df505a51d0807dbbe9b">Sensor::getRightReading</a></div><div class="ttdeci">float getRightReading()</div><div class="ttdoc">Get sensor reading at -30deg.</div><div class="ttdef"><b>Definition:</b> <a href="sensor_8cpp_source.html#l00086">sensor.cpp:86</a></div></div>
<div class="ttc" id="class_camera_html_a77cd72118fd9d03e04beaf60f7345138"><div class="ttname"><a href="class_camera.html#a77cd72118fd9d03e04beaf60f7345138">Camera::setNowTurn</a></div><div class="ttdeci">void setNowTurn(int turn)</div><div class="ttdoc">Set value of the integer which represents the direction of turn.</div><div class="ttdef"><b>Definition:</b> <a href="camera_8cpp_source.html#l00146">camera.cpp:146</a></div></div>
<div class="ttc" id="class_sensor_html_a68826b1eb0dcda3a0508f213a42db25b"><div class="ttname"><a href="class_sensor.html#a68826b1eb0dcda3a0508f213a42db25b">Sensor::getLeftReading</a></div><div class="ttdeci">float getLeftReading()</div><div class="ttdoc">Get sensor reading at 30deg.</div><div class="ttdef"><b>Definition:</b> <a href="sensor_8cpp_source.html#l00089">sensor.cpp:89</a></div></div>
<div class="ttc" id="class_sensor_html_ae3914c5ebf7891ec734c4d17e7c4cd3d"><div class="ttname"><a href="class_sensor.html#ae3914c5ebf7891ec734c4d17e7c4cd3d">Sensor::setObstacleDetected</a></div><div class="ttdeci">void setObstacleDetected(bool obs)</div><div class="ttdoc">Set status of obstacle detection.</div><div class="ttdef"><b>Definition:</b> <a href="sensor_8cpp_source.html#l00119">sensor.cpp:119</a></div></div>
<div class="ttc" id="class_sensor_html_af590a94a155718952a71ee842a0db661"><div class="ttname"><a href="class_sensor.html#af590a94a155718952a71ee842a0db661">Sensor::getObstacleDetected</a></div><div class="ttdeci">bool getObstacleDetected()</div><div class="ttdoc">check if obstacle is detected</div><div class="ttdef"><b>Definition:</b> <a href="sensor_8cpp_source.html#l00098">sensor.cpp:98</a></div></div>
<div class="ttc" id="class_bot_html_a07fd8d141a617b711eee7ab3c9e99171"><div class="ttname"><a href="class_bot.html#a07fd8d141a617b711eee7ab3c9e99171">Bot::turnRight</a></div><div class="ttdeci">void turnRight(double desiredAngle)</div><div class="ttdoc">turn robot in right direction</div><div class="ttdef"><b>Definition:</b> <a href="bot_8cpp_source.html#l00182">bot.cpp:182</a></div></div>
<div class="ttc" id="class_camera_html_a66d6f05a42feb58468bc4039b07b1b23"><div class="ttname"><a href="class_camera.html#a66d6f05a42feb58468bc4039b07b1b23">Camera::setCountB</a></div><div class="ttdeci">void setCountB(int cB)</div><div class="ttdoc">Set value of the counter which determines the time after which the robot has to take turn after detec...</div><div class="ttdef"><b>Definition:</b> <a href="camera_8cpp_source.html#l00152">camera.cpp:152</a></div></div>
<div class="ttc" id="class_bot_html_aeae87db5fd2d6a130587f665e39a6557"><div class="ttname"><a href="class_bot.html#aeae87db5fd2d6a130587f665e39a6557">Bot::resetBot</a></div><div class="ttdeci">void resetBot()</div><div class="ttdoc">reset velocities of the bot</div><div class="ttdef"><b>Definition:</b> <a href="bot_8cpp_source.html#l00168">bot.cpp:168</a></div></div>
<div class="ttc" id="class_bot_html_abc25556b72a44e45056d161eaa48e1c6"><div class="ttname"><a href="class_bot.html#abc25556b72a44e45056d161eaa48e1c6">Bot::moveForward</a></div><div class="ttdeci">void moveForward(double desiredPos)</div><div class="ttdoc">move forward by some distance</div><div class="ttdef"><b>Definition:</b> <a href="bot_8cpp_source.html#l00216">bot.cpp:216</a></div></div>
<div class="ttc" id="class_sensor_html_a1984ff9826d1c92d7e91add776a4107b"><div class="ttname"><a href="class_sensor.html#a1984ff9826d1c92d7e91add776a4107b">Sensor::getCurrentYaw</a></div><div class="ttdeci">double getCurrentYaw()</div><div class="ttdoc">Get sensor reading of current yaw angle.</div><div class="ttdef"><b>Definition:</b> <a href="sensor_8cpp_source.html#l00092">sensor.cpp:92</a></div></div>
<div class="ttc" id="class_sensor_html_a1b7aad1c82fa6df205b166b311f45447"><div class="ttname"><a href="class_sensor.html#a1b7aad1c82fa6df205b166b311f45447">Sensor::getSafeDistance</a></div><div class="ttdeci">double getSafeDistance()</div><div class="ttdoc">Get max safe distance.</div><div class="ttdef"><b>Definition:</b> <a href="sensor_8cpp_source.html#l00101">sensor.cpp:101</a></div></div>
<div class="ttc" id="class_bot_html_a5c1f98ef7f22894832865c5987d184c3"><div class="ttname"><a href="class_bot.html#a5c1f98ef7f22894832865c5987d184c3">Bot::startMotion</a></div><div class="ttdeci">void startMotion()</div><div class="ttdoc">Start running the bot.</div><div class="ttdef"><b>Definition:</b> <a href="bot_8cpp_source.html#l00061">bot.cpp:61</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="bot_8cpp.html">bot.cpp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
